= Pi Camera
Jordan Williams <jordan@jwillikers.com>
:experimental:
:icons: font
:keywords: camera photo pi picamera python raspberry
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]
:asdf: https://asdf-vm.com[asdf]
:asdf-nodejs: https://github.com/asdf-vm/asdf-nodejs[asdf-nodejs]
:asdf-version-tag: v0.14.0
:Immich: https://immich.app/[Immich]
:Immich-CLI: https://immich.app/docs/features/command-line-interface/[Immich CLI]
:MinIO: https://min.io/[MinIO]
:nodejs-version: 20.11.0
:picamera2: https://github.com/raspberrypi/picamera2[picamera2]
:pip-tools: https://github.com/jazzband/pip-tools[pip-tools]
:podman: https://podman.io/[podman]
:Raspberry-Pi-Camera: https://github.com/geerlingguy/pi-camera[Jeff Geerling's Raspberry Pi Camera]
:Rclone: https://rclone.org/[Rclone]
:systemd: https://systemd.io/[systemd]
:Getting-Started-with-HyperPixel-4-0: https://learn.pimoroni.com/article/getting-started-with-hyperpixel-4[Getting Started with HyperPixel 4.0]

A minimal Raspberry Pi camera that automatically syncs your photos.
It is based on {Raspberry-Pi-Camera} project.

ifdef::env-github[]
++++
<p align="center">
  <img  alt="Pi Camera Front Hand" src="pics/Pi Camera Front Hand.jpg?raw=true"/>
</p>
++++
endif::[]

ifndef::env-github[]
image::pics/Pi Camera Front Hand.jpg[Pi Camera Front Hand, align=center]
endif::[]

== Overview

The Pi Camera is a minimal digital camera build which automatically uploads your photographs.
When a picture is taken and saved to the `~/Pictures` directory, its presence is automatically detected by {systemd}.
When an internet connection is next available, systemd uploads the photos to either S3-compatible object storage with {Rclone} or to {Immich} with the {Immich-CLI}.
The photos are then removed from local storage.
This repository documents how I've made the camera, the configuration files I've used, and the procedure to create the camera.

== Components

The Pi Camera is based off of the Raspberry Pi 4 and the Camera Module 3.
The camera uses Pimoroni's HyperPixel 4.0 screen which has good support in the Raspberry Pi kernel and full graphics acceleration.
The screen also works under Wayland.
A momentary push button is used to take pictures.
The HyperPixel 4.0 screen takes up all of the pins, only exposing an I2C bus.
The PCF8574 I2C GPIO Expander is used to connect the momentary push button to the Raspberry Pi.

[NOTE]
====
Although the Raspberry Pi 5 is now out, it requires active cooling and a higher power input.
This makes it less suitable for a portable camera than the Raspberry Pi 4.
====

.Pi Camera Components
* https://www.raspberrypi.com/products/raspberry-pi-4-model-b/[Raspberry Pi 4 Model B] (2 GB RAM or better)
* https://www.raspberrypi.com/products/camera-module-3/[Raspberry Pi Camera Module 3]
* https://www.adafruit.com/product/1646[100mm Flex Cable for Raspberry Pi Camera]
* https://www.arducam.com/product/white-camera-enclosure-case-pi-cameras/[Camera Enclosure Case for Raspberry Pi Camera Module 3/V1/V2 and Arducam 16MP/64MP Camera]
* https://shop.pimoroni.com/products/hyperpixel-4?variant=12569485443155[Pimoroni HyperPixel 4.0 - Hi-Res Display for Raspberry Pi - Touch]
* https://www.adafruit.com/product/5545[Adafruit PCF8574 I2C GPIO Expander]
* https://www.adafruit.com/product/4209[STEMMA QT / Qwiic JST SH 4-pin to Premium Male Headers Cable - 150mm Long]
* https://amzn.to/3ijIj0C[Twidec 12mm momentary push button]
* A sufficiently large and performant microSD card.
The https://www.samsung.com/us/computing/memory-storage/memory-cards/pro-ultimate-adapter-microsdxc-128gb-mb-my128sa-am/[128GB Samsung Pro Ultimate] and https://www.samsung.com/us/computing/memory-storage/memory-cards/pro-endurance-adapter-microsdxc-128gb-mb-mj128ka-am/[128GB Samsung Pro Endurance] are two good options.
* A USB battery bank.
I'd recommend getting a battery with at least a 5000mAh capacity with the smallest form factor possible.
I use the https://www.adafruit.com/product/4288[USB Li-Ion Power Bank with 2 x 5V Outputs @ 2.1A - 5000mAh].
* A USB-C cable for powering the Pi.
* A case.
I found that LEGO Technics make a pretty sturdy case.
A minimal $13 LEGO Technics set was sufficient for making the enclosure for the camera.
I bought a second to make the case even better and add an enclosure for the battery.
I've been avoiding dealing with CAD files, but it should be possible to make some modifications to the CAD files from Jeff Geerling's https://github.com/geerlingguy/pi-camera[Raspberry Pi Camera] to account for the HyperPixel 4.0 screen.

== Build

The build is pretty straightforward.
It requires solder and a soldering iron to wire the PCF8574 to the momentary push button.

ifdef::env-github[]
++++
<p align="center">
  <img  alt="Pi Camera PCF8574" src="pics/Pi Camera PCF8574.jpg?raw=true"/>
</p>
++++
endif::[]

ifndef::env-github[]
image::pics/Pi Camera PCF8574.jpg[Pi Camera PCF8574, align=center]
endif::[]

. Trim the length of the wires on the momentary push button.
They can be trimmed pretty short, but keep enough room to make up for any mistakes.
I only kept a couple of centimeters on each wire.
. Solder the leads of the momentary push button to the PCF8574 I2C GPIO Expander breakout.
Solder the black lead to ground and the red lead to `P0`.
. Attach the HyperPixel 4.0 to the Raspberry Pi.
Follow the instructions from {Getting-Started-with-HyperPixel-4-0}.
. Plug the male header pins on the STEMMA QT / Qwiic JST SH 4-pin to Premium Male Headers Cable to the HyperPixel 4.0.
With the screen face up, and the pins and micro HDMI ports facing towards you, the pins are ordered ground, clock, data, and power from left to right.
The associated cable colors are documented in the following table.

.Stemma Qt / Qwiic Cable Colors
[cols="1,1"]
|===
| Function | Color

| Ground | Black
| Clock | Yellow
| Data | Blue
| Power | Red
|===

. Attach the JST SH plug on STEMMA QT / Qwiic cable to the PCF8574 breakout.
It can be connected to either end of the board.
. Connect the flex cable to the 2-lane MIPI CSI camera port on the Raspberry Pi.
This port is next to the audio jack on the Raspberry Pi 4 Model B.
The side with the silver lines should face towards the micro HDMI ports.
The blue side should face towards the USB ports.
This process is documented by Raspberry Pi in the https://www.raspberrypi.com/documentation/accessories/camera.html#connecting-the-camera[Connecting the Camera] section of the Camera page.
+
[CAUTION]
====
Be gentle with the camera port, as they are fairly breakable.
====

. Connect the other end of the flex cable to the Raspberry Pi Camera Module 3.
The silver lines should be facing up, towards the camera's lens.
. Install the camera module in the camera enclosure case.
. Fit the case.
I'm not going to detail my ad-hoc case build, though hopefully the pictures provide some guidance.
However, be aware that the camera module should be positioned upright.
This is confusing because upright actually looks sideways with how the text is printed on the camera module.
This is important because the picamera2 library only allows flipping the image 180° at this time.
Other software techniques are necessary to flip the camera image 90° or 270°.
Issues https://github.com/raspberrypi/picamera2/issues/492[#492], https://github.com/raspberrypi/picamera2/issues/774[#774], and https://github.com/raspberrypi/picamera2/issues/792[#792] in the https://github.com/raspberrypi/picamera2[picamera2 Project] request this functionality.

== Storage

The photos are uploaded somewhere, which requires some configuration.
The photos can be uploaded to {Immich} or to S3-compatible object storage.
The latter will document how to do this specifically for MinIO.
Both my MinIO and Immich setups are documented in my https://github.com/jwillikers/home-lab-helm[Home Lab Helm] repository.
Using MinIO is more secure as an API token can be scoped with access that is limited to uploading photos.
For Immich, it is possible to use the local API token on the Pi Camera to delete uploaded photos or do even worse if the API token belongs to an admin user.

=== MinIO

The instructions here are for setting up S3-compatible object storage using a a self-hosted MinIO instance with a dedicated `pi-camera` bucket for the pictures.
These instructions describe how to create the `pi-camera` bucket and generate an access key with the required write-access necessary to upload the photos with Rclone.
The instructions assume that {Podman} is installed.

[NOTE]
====
These commands are _not_ meant to be run the Pi itself.
Run these commands on your hopefully more secure computer.
====

. Create a configuration to access the MinIO server.
+
[,sh]
----
podman run \
  --interactive \
  --name minio-client \
  --rm \
  --tty \
  --user $(id -u):$(id -g) \
  --userns keep-id \
  --volume minio-client-config:/.mc:Z \
  quay.io/minio/mc:latest \
  alias set jwillikers https://minio.jwillikers.io
mc: Configuration written to `/.mc/config.json`. Please update your access credentials.
mc: Successfully created `/.mc/share`.
mc: Initialized share uploads `/.mc/share/uploads.json` file.
mc: Initialized share downloads `/.mc/share/downloads.json` file.
Enter Access Key: abcde123
Enter Secret Key:
Added `jwillikers` successfully.
----

. Create a `pi-camera` bucket in MinIO to store the pictures.
+
[,sh]
----
podman run \
  --interactive \
  --name minio-client \
  --rm \
  --tty \
  --user $(id -u):$(id -g) \
  --userns keep-id \
  --volume minio-client-config:/.mc:Z \
  quay.io/minio/mc:latest \
  mb jwillikers/pi-camera
----

. Place a quota on the `pi-camera` bucket to prevent uploading too much data.
+
[,sh]
----
podman run \
  --interactive \
  --name minio-client \
  --rm \
  --tty \
  --user $(id -u):$(id -g) \
  --userns keep-id \
  --volume minio-client-config:/.mc:Z \
  quay.io/minio/mc:latest \
  mc quota set jwillikers/pi-camera --size 200gi
----

. Generate an access token for the Minio server which uses the `pi-camera-minio-policy.json` policy.
This policy allows only the minimal access necessary for Rclone to upload files to the bucket.
+
[,sh]
----
podman run \
  --interactive \
  --name minio-client \
  --rm \
  --tty \
  --user $(id -u):$(id -g) \
  --userns keep-id \
  --volume minio-client-config:/.mc:Z \
  --volume ./pi-camera-minio-policy.json:/pi-camera-minio-policy.json:Z \
  quay.io/minio/mc:latest \
  admin user svcacct add --description "Pi Camera" --name "Pi Camera" --policy "pi-camera-minio-policy.json" jwillikers core
Access Key: XXXXXXXXXXXXXXXXXXXX
Secret Key: ****************************************
Expiration: no-expiry
----

=== Immich

Uploads to Immich are pretty straightforward using the {Immich-CLI} utility.
Photos will be uploaded to a user account.
For security, create a dedicated user account to prevent any potential misuse of the API key.
Unfortunately, since it isn't possible to limit the scope of an API key, the key can still be abused to delete photos for this user's account.
With that in mind, there are important limitations with partner sharing at the moment which, is probably how you'll want to access the pictures from a dedicated account.
Right now, facial recognition and favorites won't work across partner sharing, although these are requested features.
It's also not possible to import shared photos to your account either.
The following instructions walkthrough how to create this account using the Immich API.
The WebUI can be used to accomplish the same tasks.
My Immich server resides at `https://immich.jwillikers.io`.
Replace it with the URL of your Immich instance.

. Login as an admin user and obtain an access token.
Substitute your user's username and password.
+
[TIP]
====
Precede the following commands that use the sensitive data such as your password and access token with a space to omit them from your shell's history.
====
+
--
[,sh]
----
 curl --location 'https://immich.jwillikers.io/api/auth/login' \
  --header 'Content-Type: application/json' \
  --header 'Accept: application/json' \
  --data-raw '{
    "email": "jordan@jwillikers.com",
    "password": "password"
  }'
----

The successful response from this command includes the access token as the value for the `accessToken` key.
--


. Create a dedicated user account for the Pi Camera with a quota.
The following command creates the `Pi Camera` user with a quota of 5 GiB.
Substitute the API key generated in the previous step for `<access_token>` and use a good password for the Pi Camera user, not _password_.
+
--
[,sh]
----
 curl --location 'https://immich.jwillikers.io/api/user' \
  --header 'Authorization: Bearer <access_token>' \
  --header 'Content-Type: application/json' \
  --header 'Accept: application/json' \
  --data '{
    "email": "pi-camera@jwillikers.com",
    "name": "Pi Camera",
    "password": "password",
    "quotaSizeInBytes": 5368709120
  }'
----

The response will return the user's `id` which will be used in the following command.
--

. Disable the need to change the user's password.
Use the Pi Camera user's id for `id` in this command.
+
[,sh]
----
 curl --location --request PUT 'https://immich.jwillikers.io/api/user' \
  --header 'Authorization: Bearer <access_token>' \
  --header 'Content-Type: application/json' \
  --header 'Accept: application/json' \
  --data '{
    "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
    "shouldChangePassword": false
  }'
----

. Log out from the admin user's account.
+
[,sh]
----
 curl --location --request POST 'https://immich.jwillikers.io/api/auth/logout' \
  --header 'Authorization: Bearer <access_token>' \
  --header 'Accept: application/json'
----

. Now log in as the Pi Camera user.
+
--
[,sh]
----
 curl --location 'https://immich.jwillikers.io/api/auth/login' \
  --header 'Content-Type: application/json' \
  --header 'Accept: application/json' \
  --data-raw '{
    "email": "pi-camera@jwillikers.com",
    "password": "password"
  }'
----

The successful response from this command includes the access token as the value for the `accessToken` key.
--

. Find the id for any users you want to add as partners to the Pi Camera account.
Obtain all of the users with this command.
+
[,sh]
----
 curl --location 'https://immich.jwillikers.io/api/user' \
  --header 'Authorization: Bearer <access_token>' \
  --header 'Accept: application/json'
----

. For each desired user, run the following command to add them as a partner.
Use the user's id as the last path in the URL, replacing `:id`.
+
[,sh]
----
 curl --location --request POST 'https://immich.jwillikers.io/api/partner/:id' \
  --header 'Accept: application/json' \
  --header 'Authorization: Bearer <access_token>'
----

. Generate an API key for the Pi Camera user.
Getting an API key is documented in the https://immich.app/docs/features/command-line-interface/#obtain-the-api-key[Obtain the API Key] section of the Immich CLI page.
+
--
[,sh]
----
curl --location 'https://immich.jwillikers.io/api/api-key' \
  --header 'Authorization: Bearer <access_token>' \
  --header 'Content-Type: application/json' \
  --header 'Accept: application/json' \
  --data '{
    "name": "Pi Camera Upload"
  }'
----

The value for the `secret` key in the response is the API token that will be used later on the Pi Camera.
Don't lose it or you'll have to generate another one.
--

. Log out from the Pi Camera user's account.
+
[,sh]
----
 curl --location --request POST 'https://immich.jwillikers.io/api/auth/logout' \
  --header 'Authorization: Bearer <access_token>' \
  --header 'Accept: application/json'
----

== Install

. Install 64-bit full version of https://www.raspberrypi.com/software/[Raspberry Pi OS] to a microSD card.
The configuration files assume the primary user is `pi-camera`, which can be configured when using Raspberry Pi Imager to write the image.
This project has been tested with Raspberry Pi OS 5 based on Debian Bookworm.
. Insert the microSD card into the Raspberry Pi.
. Boot the Raspberry Pi.
. Make the `~/Projects` directory.
+
[,sh]
----
mkdir --parents ~/Projects
----

. Clone this project's repository, again, to the `~/Projects` directory.
+
[,sh]
----
git -C ~/Projects clone https://github.com/jwillikers/pi-camera.git
----

. Append the contents of the `boot/firmware/config.txt.append` file to the `/boot/firmware/config.txt` file.
+
[,sh]
----
cat boot/firmware/config.txt.append | tee append /boot/firmware/config.txt
----

. Reboot.
. Update the package lists.
+
[,sh]
----
sudo apt-get update
----

. Upgrade everything.
+
[,sh]
----
sudo apt-get --yes full-upgrade
----

. Install the necessary and unnecessary packages.
I like fish, tmux, and vim, what can I say?
+
[,sh]
----
sudo apt-get --yes install apt-transport-https firewalld fish git python3-dev python3-picamera2 python3-venv raspberrypi-ui-mods rclone tmux vim wlr-randr
----

. Install Tailscale.
.. Add the Tailscale signing key to the system keyring.
+
[,sh]
----
curl -fsSL https://pkgs.tailscale.com/stable/raspbian/bullseye.noarmor.gpg | sudo tee /usr/share/keyrings/tailscale-archive-keyring.gpg > /dev/null
----

.. Add the Tailscale repository to the system.
+
[,sh]
----
curl -fsSL https://pkgs.tailscale.com/stable/raspbian/bullseye.tailscale-keyring.list | sudo tee /etc/apt/sources.list.d/tailscale.list
----

.. Refresh the packages.
+
[,sh]
----
sudo apt-get update
----

.. Install the Tailscale package.
+
[,sh]
----
sudo apt-get --yes install tailscale
----

.. Start Tailscale and authenticate.
I use an exit node to route all traffic through Tailscale.
Modify or omit the `--exit-node` flag as necessary.
+
[,sh]
----
sudo tailscale up --exit-node=fd7a:115c:a1e0:ab12:4843:cd96:625f:e80c
----

. Change to the project's root directory.
+
[,sh]
----
cd pi-camera
----

. Create a symlink of the `wayfire.ini` file in the `~/.config` directory.
+
[,sh]
----
ln --relative --symbolic wayfire.ini ~/.config/wayfire.ini
----

. Create a virtual environment for the project.
+
[,sh]
----
python -m venv --system-site-packages ~/pi-camera-venv
----

. Activate the virtual environment.
+
[,sh]
----
source ~/pi-camera-venv/bin/activate.fish
----

. Install the dependencies in the venv.
+
[,sh]
----
python -m pip install --requirement requirements.txt
----

. Exit the virtual environment.
+
[,sh]
----
exit
----

. Set up {Immich-CLI} or Rclone for uploading the photos.
+
Immich CLI::
+
[NOTE]
====
The version of NodeJS shipped in Debian Bookworm is too old for {Immich-CLI}.
{asdf} makes it possible to easily install a newer version of NodeJS.
====
+
.. Switch to a shell for the root user.
Immich CLI is installed and configured for the root user to limit access to the API key used to upload the photos.
There's a tradeoff here between exposing the system to NPM vulnerabilities and hiding the API key so that the automatically logged in user can't just see it.
Given, anyone who mounts the SD card can trivially access this file.
One other important factor for why this is done is that the `network-online.target` is only available for the systemd system instance.
+
[,sh]
----
sudo su
----

.. Clone the repository for {asdf}.
+
[,sh,subs="attributes+"]
----
git clone https://github.com/asdf-vm/asdf.git ~/.asdf --branch {asdf-version-tag}
----

.. Install asdf in your shell.
https://asdf-vm.com/guide/getting-started.html#_3-install-asdf[installation documentation] contains a nice list for a lot of different shells.
I'll cover Bash because I have to here, but I'll also include the instructions for my favorite shells.
+
Bash::: Load the `asdf.sh` script in `~/.profile`.
+
.~/.profile
[,sh]
----
. "$HOME/.asdf/asdf.sh"
----

fish::: Load the `asdf.fish` script in the fish shell's configuration.
+
.~/.config/fish/conf.d/asdf.fish
[,sh]
----
source ~/.asdf/asdf.fish
----

Nushell::: Load the `asdf.nu` script in `~/.config/nushell/config.nu` by running the following command.
+
[,nushell]
----
"\n$env.ASDF_DIR = ($env.HOME | path join '.asdf')\n source " + ($env.HOME | path join '.asdf/asdf.nu') | save --append $nu.config-path
----

.. Now, load the updated configuration for your shell.
For fish and Nushell, just open a new shell to accomplish this.
The Bash configuration uses `~/.profile`, which is only loaded when logging in, so log out and back in to load that or run `source ~/.profile` to load it in the current shell.

.. Install the necessary packages for the NodeJS plugin for asdf, {asdf-nodejs}.
+
[,sh]
----
sudo apt-get --yes install dirmngr gpg curl gawk
----

.. Add the NodeJS plugin to asdf.
+
[,sh]
----
asdf plugin add nodejs https://github.com/asdf-vm/asdf-nodejs.git
----

.. Install NodeJS.
Immich CLI currently requires at least version 20 of NodeJS.
At the time of writing, this is the latest LTS, so I'm grabbing the latest minor version of NodeJS available.
+
[,sh,subs="attributes+"]
----
asdf install nodejs {nodejs-version}
----

.. Set this version of NodeJS current version globally.
To be clear, that's globally for your user.
+
[,sh,subs="attributes+"]
----
asdf global nodejs {nodejs-version}
----

.. Now install the {Immich-CLI}.
+
[,sh]
----
npm i -g @immich/cli
----

.. Set up the API key for authenticating with the Immich instance.
The last argument should be the API key generated for the Pi Camera user in the <<Immich>> section.
+
[,sh]
----
immich login-key https://immich.jwillikers.io/api the-api-key
Executing API key auth flow...
Logged in as pi-camera@jwillikers.com
Wrote auth info to /root/.config/immich/auth.yml
----

.. Now exit the root shell.
+
[,sh]
----
exit
----

Rclone::
+
.. Create the Rclone configuration directory `/etc/rclone`.
+
[,sh]
----
sudo mkdir --parents /etc/rclone/
----

.. Configure the Rclone credentials in `/etc/rclone/rclone.conf`.
+
./etc/rclone/rclone.conf
[,ini]
----
[minio]
type = s3
provider = Minio
access_key_id = ********************
secret_access_key = ****************************************
region = us-east-1
endpoint = https://minio.jwillikers.io
acl = private
----

.. Ensure that only the owner can read and write the `rclone.conf` file.
+
[,sh]
----
sudo chmod 0600 /etc/rclone/rclone.conf
----

.. Copy the systemd units in the `systemd/system` directory to the `/etc/systemd/system/` directory.
+
[,sh]
----
sudo cp systemd/system/* /etc/systemd/system/
----

. Modify the `upload-pictures.service` file as needed for the upload method.
Make sure that the line for the chosen method is uncommented and either comment or remove the line for the alternative method.
+
./etc/systemd/system/upload-pictures.service
[,systemd]
----
include::systemd/system/upload-pictures.service[]
----

. Enable and start the systemd service `upload-pictures.path` unit.
This unit will automatically run the similarly named service whenever new pictures are added to this directory.
+
[,sh]
----
sudo systemctl enable --now upload-pictures.path
----

. Create the systemd directory for user units.
+
[,sh]
----
mkdir --parents ~/.config/systemd/user
----

. Symlink the `pi-camera.service` unit to `~/.config/systemd/user/pi-camera.service`.
+
[,sh]
----
ln --relative --symbolic systemd/user/pi-camera.service ~/.config/systemd/user/pi-camera.service
----

. Enable and start the camera.
+
[,sh]
----
systemctl --user enable --now pi-camera.service
----

=== Configure Screen Orientation

One of the things that may need tweaked is the screen orientation.
This is technically configured in two places, the `/boot/firmware/config.txt` file, where it can be changed using the `rotate` `dtparam`, and additionally in Wayfire.
The configuration for Wayfire is documented in the https://www.raspberrypi.com/documentation/computers/configuration.html#setting-the-desktop-environment-resolution-and-rotation[Setting the desktop environment resolution and rotation section] of the Raspberry Pi Configuration documentation.
It is also described in the https://github.com/WayfireWM/wayfire-wiki/blob/master/Configuration.md[Configuration.md] file in the Wayfire repository.
The instructions here describe the basics necessary to rotate the screen.

. Determine the available display outputs with the `kmsprint` command.
Here, `DPI-1` corresponds to the HyperPixel 4.0.
+
[,sh]
----
kmsprint | grep Connector
Connector 0 (32) HDMI-A-1 (disconnected)
Connector 1 (42) HDMI-A-2 (disconnected)
Connector 2 (48) DPI-1 (connected)
----

. Use `wlr-randr` to rotate the display.
When running the command from an SSH connection, include the `WAYLAND_DISPLAY=wayland-1` variable as done here.
+
[,sh]
----
WAYLAND_DISPLAY=wayland-1 wlr-randr --output DPI-1 --transform 90
----

. To make the change permanent, configure the rotation in the Wayfire configuration file.
+
.~/.config/wayfire.ini
[,ini]
----
[output:DPI-1]
transform = 90
----

== Development

It's recommended to use the provided {pre-commit} checks when developing.

. Create a virtual environment.
+
[,sh]
----
python -m venv .env
----

. Activate the virtual environment.
+
[,sh]
----
source .env/bin/activate.fish
----

. Install the development packages.
+
[,sh]
----
python -m pip install -r requirements-dev.txt
----

. Install the packages.
This project uses pip-tools to synchronize virtual environments for development.
Sync your virtual environments packages with those pinned in the `requirements.txt` and `requirements-dev.txt` files with the `pip-sync` command.
+
[,sh]
----
pip-sync requirements-dev.txt requirements.txt
----

. Install the Git hooks for pre-commit.
+
[,sh]
----
pre-commit install
----

. Upgrade the packages pinned in the `requirements.txt` file with the `pip-compile` command.
+
[,sh]
----
pip-compile \
  --allow-unsafe \
  --generate-hashes \
  --reuse-hashes \
  --upgrade \
  requirements.in
----

. The pinned development packages in the `requirements-dev.txt` file can be upgraded in the same fashion.
+
[,sh]
----
pip-compile \
  --allow-unsafe \
  --generate-hashes \
  --reuse-hashes \
  --upgrade \
  requirements-dev.in
----

== todo

* Add EXIF metadata to the image files like GPS coordinates.
Of course, then I need to add a GPS.
* Add a Tailscale online target to systemd to only attempt uploading photos when a connection to the required Tailscale endpoint is available.
This would also make it possible to migrate the systemd units to user units.
* Make the camera application more robust.
It crashes really easily.
* Incorporate some sort of power button to safely shutdown.
* Add a NixOS configuration and build SD card images.

== See Also

* Jeff Geerling's https://github.com/geerlingguy/pi-camera[Raspberry Pi Camera]
* https://github.com/Gordon999/RPiCamGUI[RPiCamGUI]

== Code of Conduct

The project's Code of Conduct is available in the link:CODE_OF_CONDUCT.adoc[Code of Conduct] file.

== License

This repository is licensed under the https://www.gnu.org/licenses/gpl-3.0.html[GPLv3], available in the link:LICENSE.adoc[license file].

© 2023-2024 Jordan Williams

== Authors

mailto:{email}[{author}]
